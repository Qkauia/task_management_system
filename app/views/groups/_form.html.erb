<%= form_with model: @group, local: true do |form| %>
  <div class="mb-3">
    <%= form.label :name, t('groups.form.name'), class: "form-label" %>
    <%= form.text_field :name, class: "form-control" %>
  </div>
  
  <div class="align-items-center mb-3" data-controller="user-buttons">
    <div class="mb-3">
      <p><%= t('users.form.choose_share_with_other_users') %></p>
    </div>
    <span class="btn btn-success btn-sm">
      <%= t('users.form.selected') %> <span data-user-buttons-target="totalCount" class="fw-bold"><%= @group.user_ids.size %></span> <%= t('users.form.peoples') %>
    </span>
    <button class="btn btn-danger btn-sm ms-1" data-action="click->user-buttons#clearAll"><%= t('users.form.clear_all_selections') %></button>
    
    <div class="mt-3">
      <% @users_by_letter.each do |letter, users| %>
        <button class="btn btn-secondary dropdown-toggle mb-2 align-items-center" type="button" id="dropdown<%= letter %>" data-bs-toggle="dropdown" aria-expanded="false" data-user-buttons-target="letter" data-letter="<%= letter %>" style="width: 95px;">
          <%= letter %>
          <span data-user-buttons-target="count" data-letter="<%= letter %>" class="badge rounded-circle bg-success bg-opacity-25 ms-2"></span>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdown<%= letter %>">
          <% users.each do |user| %>
            <li>
              <label class="dropdown-item user-button" data-action="click->user-buttons#toggle" data-user-buttons-target="button" data-letter="<%= letter %>">
                <input type="checkbox" name="group[user_ids][]" value="<%= user.id %>" autocomplete="off" <%= 'checked' if @group.user_ids.include?(user.id) %> hidden>
                <%= user.email %>
              </label>
            </li>
          <% end %>
        </ul>
      <% end %>
    </div>
  </div>

  <%= form.submit class: "btn btn-primary" %>
  <%= link_to t('tasks.link.back'), groups_path, class: "btn btn-secondary" %>
<% end %>
